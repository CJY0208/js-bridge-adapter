!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(n.JsBridgeAdapter={})}(this,function(n){"use strict";var l=function(n){return"function"==typeof n},a=function(n){return"string"==typeof n},d=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=arguments[2];try{var t=(a(e)?e.split("."):e).reduce(function(n,e){return n[e]},n);return function(n){return void 0===n}(t)?r:t}catch(n){return r}},c=function(n){for(var e=arguments.length,r=Array(2<e?e-2:0),t=2;t<e;t++)r[t-2]=arguments[t];var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];i=a(i)?i.split("."):i;var o=d(n,i),u=d(n,i.slice(0,-1));return l(o)?o.call.apply(o,[u].concat(r)):o},u=0,f=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}(),e=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=e.name,t=void 0===r?function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"")+"_"+ ++u+"_"+Date.now()+"_"+Math.floor(1e6*Math.random())}("__globalFunction"):r,i=e.once,o=void 0!==i&&i;return"string"==typeof n?n:(f[t]=function(){"function"==typeof n&&n.apply(void 0,arguments),o&&delete f[t]},t)};var r=function n(){var i=this;!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.__listeners={},this.subscribe=function(n,e){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(!l(e))return console.error("[EventBus Error] listener is not a function");i.__listeners[n]=[].concat(function(n){if(Array.isArray(n)){for(var e=0,r=Array(n.length);e<n.length;e++)r[e]=n[e];return r}return Array.from(n)}(d(i.__listeners,n,[])),[Object.assign(e,{once:r})])},this.notify=function(n){for(var e=arguments.length,r=Array(1<e?e-1:0),t=1;t<e;t++)r[t-1]=arguments[t];i.__listeners[n]=c(i.__listeners,n+".filter",function(n){return c.apply(void 0,[n,void 0].concat(r)),!n.once})}},s=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n};var p=function(n){return"function"==typeof n},g=function n(e){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(n){return"function"==typeof n?{getExecutor:n}:n}(e),t=r.name,i=void 0===t?"":t,o=r.getExecutor,u=function(n,e,r){return e in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}({},i,function(){for(var n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];var t=o.apply(this,e);if(p(t))return t.apply(this,e)})[i],a={configurable:!0,enumerable:!1};return Object.defineProperty(u,"name",s({value:i,writable:!1},a)),Object.defineProperty(u,"length",s({},a,{get:function(){var n=o();return p(n)?n.length:-1}})),u.getExecutor=o,u.isExecutable=function(){for(var n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];return p(o.apply.apply(o,[this].concat(e)))},u};var i=function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(n){return"function"==typeof n?{runner:n}:n}(e),t=r.runner,i=void 0===t?n.default.runner:t,o=r.isSupported,u=void 0===o?n.default.isSupported:o,a=r.name,c=void 0===a?d(i,"name"):a,f=r.getRunner,s=new g({name:c,getExecutor:void 0===f?function(){return!(!l(i)||!u())&&i}:f});return s.isSupported=s.isExecutable,s.getRunner=s.getExecutor,delete s.isExecutable,delete s.getExecutor,s};i.default={isSupported:function(){return!0},runner:void 0};var t=function n(){var u=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"anonymous";!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.eventBus=new r,this.isReady=!1,this.configured=!1,this.runAfterReady=!1,this.apis={},this.onReady=function(n){return u.eventBus.subscribe("ready",n,!0),u.isReady&&u.eventBus.notify("ready"),u},this.ready=function(){if(u.isReady)return console.error('[Warning] Bridge "'+u.name+'" is ready');u.isReady=!0,u.eventBus.notify("ready")},this.config=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=n.support,r=n.api,t=n.runAfterReady,i=void 0!==t&&t;return u.configured?console.error('[Warning] Bridge "'+u.name+'" has been configured'):(u.bridgeSupport=e,u.getRunner=r,u.runAfterReady=i,u.configured=!0),u},this.support=function(n){var e=u.get(n);return!!c(e,"isSupported")},this.api=function(e){var n=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).runner,r=void 0===n?u.getRunner(e):n,t=new i({name:e,runner:r,isSupported:function(){return!!u.isReady&&u.bridgeSupport(e)}});return t.isFromBridge=!0,t.customize=function(n){return u.api(e,{runner:n(r)})},t},this.register=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(u.apis,c(n,void 0,u.api)),u},this.has=function(n){return!!u.apis[n]},this.get=function(n){return u.apis[n]},this.call=function(e){for(var n=arguments.length,r=Array(1<n?n-1:0),t=1;t<n;t++)r[t-1]=arguments[t];if(!u.has(e))return console.warn('[Unregistered] Api "'+e+'" is unregistered in Bridge "'+u.name+'"');var i=u.get(e),o=function(){var n=c(i,"getRunner");return l(n)?n.apply(void 0,r):console.warn('[Not Supported] Api "'+e+'" is not supported by Bridge "'+u.name)};return u.isReady||!i.isFromBridge?o():u.runAfterReady?new Promise(function(n){return u.onReady(function(){return n(o())})}):console.warn('[Not Ready] Bridge "'+u.name+'" is not ready, can\'t call Api "'+e+'"')},this.name=e};t.Api=i,t.globalize=e,n.default=t,n.Api=i,n.Bridge=t,n.DynamicFunction=g,n.globalize=e,Object.defineProperty(n,"__esModule",{value:!0})});
